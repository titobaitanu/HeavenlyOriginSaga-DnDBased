# ============================================================
# EVENT/WORLD_EVENT_ENGINE.YAML — HEAVENLY ORIGIN SAGA
# Secure Public Version (v3.2)
# ============================================================
# Repository Path: event/world_event_engine.yaml
# Maintainer: Heavenal Control Node
# License: Dual (MIT + Heavenal Law Open-Collab)
# ============================================================

meta:
  file_id: "EVENT-WORLD-ENGINE"
  title: "World Event Engine"
  version: 3.2-secure
  author: "Tito Baitanu"
  maintainer: "Heavenal Control Node"
  status: verified
  repository_link: "HeavenlyOriginSaga-DnDBased"
  checksum: "EVENT-WORLD-SHA-31F8A"
  last_updated: "2025-11-11"

overview:
  description: >
    The World Event Engine (WEE) orchestrates dynamic events across Mortal,
    Immortal, Divine, Abyssal, and Beast Realms. It drives emergent stories,
    NPC behaviour, faction conflicts, economic shifts, ascension trials,
    and Heavenal interventions. The engine supports deterministic and
    stochastic event spawning, scheduled "Epoch" events, and reactive triggers
    tied to player and faction actions.
  purpose: >
    Provide GM and system-level automation for large-scale narrative
    and mechanical interactions while remaining fully auditable and
    configurable via codex and manifest bindings.

core_components:
  scheduler:
    name: "Heavenal Scheduler"
    tick_unit: "Heavenal Day"
    resolution: "seconds (internal simulation)"
    epoch_types:
      - "Micro Event"      # local, short-lived (e.g., bandit raid)
      - "Regional Event"   # affects province/kingdom (e.g., famine)
      - "Realm Event"      # affects entire realm (e.g., Void Rift)
      - "Epoch Event"      # era-changing (e.g., Divine Intervention)
    restock_cycle:
      shop_restocks: "7 Heavenal Days"
      npc_refresh: "3 Heavenal Days"
      world_resource_update: "1 Heavenal Day"

  trigger_system:
    name: "Karma & Trigger Bus"
    triggers:
      - type: "ActionTrigger"
        description: "Player or faction action exceeds threshold"
      - type: "TimeTrigger"
        description: "At scheduled times or epoch milestones"
      - type: "KarmaTrigger"
        description: "Global or local karma spike/drop"
      - type: "ConflictTrigger"
        description: "Legion mobilization or diplomatic breach"
      - type: "AscensionTrigger"
        description: "Cultivator ascension attempt / tribulation event"
      - type: "LawAnomalyTrigger"
        description: "Detected law-writing / illegal law manipulation"

  event_generator:
    name: "Event Composer"
    modes:
      - deterministic: "Pre-defined, codex-anchored events"
      - procedural: "GM-seeded, rule-based emergent events"
      - sandbox: "Player-driven with GM supervision"
    composition_elements:
      - "actor_pool"      # NPCs / Factions / Legions involved
      - "location_node"   # world map coordinate or region
      - "stakes"          # reward, risk, karma impact
      - "mechanics"       # combat, diplomacy, economy, crafting
      - "timeline"        # duration and follow-up phases

mechanics:
  difficulty_scaling:
    base_factor: 1.0
    realm_multiplier:
      mortal: 1.0
      immortal: 1.5
      divine: 3.0
      abyss: 1.7
      beast: 1.2
    faction_power_adjustment: "event_complexity × (faction_power / baseline_power)"

  randomness_and_persistence:
    seed_policy: "GM-seedable; default derived from manifest checksum"
    persistence: "All major events logged to Heavenal Log Archive (immutable)"
    revertibility: "GM may rollback Micro/Regional events; Realm/Epoch events require Council approval"

  reward_and_consequence:
    reward_types:
      - "Material"     # items, pill, artifacts
      - "Currency"     # gold/silver/copper, spirit stone, immortal jade
      - "Reputation"   # faction reputation change
      - "Karma"        # world-level ledger adjustment
      - "AscensionBonus" # temporary boost to tribulation success chance
    consequence_types:
      - "TerritorialLoss"
      - "MarketCrash"
      - "HeavenalSeal"
      - "KarmicSpike"
      - "WorldMutation"  # rare, high-impact changes

integration:
  linked_codex:
    - "codex_conflict_matrix.yaml"
    - "codex_npc_faction.yaml"
    - "codex_economy_trade.yaml"
    - "codex_ascension_trial.yaml"
    - "codex_synchronization.yaml"
  linked_systems:
    - "systems/karma_system.yaml"
    - "systems/ascension_trial.yaml"
    - "systems/shop_catalog.yaml"
    - "systems/reward_loot_tier.yaml"
    - "systems/heaven_timer.yaml"
  data_sources:
    - "npc_registry.json"
    - "shop_catalog.yaml"
    - "world_map.yaml"
    - "manifest.yaml"

security_and_audit:
  access_control:
    gm_token_ref: "ENV[HEAVENAL_GM_TOKEN]"
    readonly_api_keys: []
    audit_level: "full"
  logging:
    event_log_level: "INFO"
    sensitive_actions_log: "ENCRYPTED"
    immutable_archive: "Heavenal Log Archive (external cryptographic store recommended)"
  integrity:
    periodic_verification: "daily"
    crosscheck_with_codex: true
    integrity_report: "event_engine_integrity.yaml"

events_catalog:  # sample event templates (extendable by GM)
  - id: "E-MIC-001"
    name: "Bandit Caravan Raid"
    type: "Micro Event"
    realm: "Mortal"
    trigger: "ActionTrigger (merchant convoy flagged)"
    spawn_conditions:
      - "region_security < 40"
      - "merchant_reputation < 30"
    actors:
      attackers: "Dynamic Bandit NPC (scaled by region)"
      defenders: "Convoy Guards / Local Militia"
    mechanics:
      - "Skill checks: ambush roll (stealth vs perception)"
      - "Combat: small-scale skirmish (rounds limited)"
      - "Loot roll: based on convoy_value and bandit_tier"
    rewards:
      success_for_defenders: ["gold", "reputation_up"]
      success_for_attackers: ["stolen_goods", "karma_down"]
    persistence: "resolves in 1–3 Heavenal Days"
    log_level: "common"

  - id: "E-REG-012"
    name: "Famine in Baiyang"
    type: "Regional Event"
    realm: "Mortal"
    trigger: "TimeTrigger (seasonal) / Climate anomaly"
    spawn_conditions:
      - "crop_yield < baseline × 0.6"
      - "merchant_supply_disruption = true"
    mechanics:
      - "Population morale check"
      - "Market price inflation (food ×1.5–×3)"
      - "Faction response: charity missions, raiding, price gouging"
    consequences:
      - "If unresolved in 30 Heavenal Days → peasant rebellion (ConflictTrigger)"
      - "If resolved → reputation_up for aiding factions"
    rewards: "quest chains, resource redistribution"
    persistence: "30–120 Heavenal Days"
    log_level: "uncommon"

  - id: "E-REAL-045"
    name: "Void Rift Emergence"
    type: "Realm Event"
    realm: "Border (Mortal/Abyss)"
    trigger: "LawAnomalyTrigger"
    spawn_conditions:
      - "local_law_stability < 25"
      - "abyssal_activity > threshold"
    mechanics:
      - "Rift growth stages (incipient → spreading → stabilized)"
      - "Spawn: Void creatures and anomalies"
      - "GCEB involvement mandatory at stage 2"
      - "Players may attempt Seal Rituals (AscensionTrial mechanics apply)"
    consequences:
      - "Persistent rift → permanent terrain mutation and forbidden zone"
      - "Successful sealing → rare rewards & karma_reduction"
    persistence: "variable (GM discretion)"
    log_level: "rare"

  - id: "E-EPOCH-900"
    name: "Heavenal Tribunal — Divine Hearing"
    type: "Epoch Event"
    realm: "Divine / Great Heaven"
    trigger: "KarmaTrigger (massive karma swing) OR Council summon"
    spawn_conditions:
      - "global_karmic_imbalance > 5000"
      - "law_violation_detected = true"
    mechanics:
      - "Assemble panel: Twelve Thrones + Heavenly Arbiter"
      - "Present case files from Heavenal Log Archive"
      - "Open hearings (public/protected) with ramifications across realms"
    consequences:
      - "Codex amendments (requires ratification)"
      - "Large-scale law sanctions (Heaven Seal, Realm Quarantine)"
      - "Possible ascension/denial for implicated parties"
    persistence: "fixed (10–100 Heavenal Days)"
    log_level: "epochal"

orchestration_tools:
  gm_console:
    features:
      - "Event preview and staging"
      - "Seed control and deterministic replay"
      - "Manual spawn/cancel capabilities"
      - "Immutable approval workflow for realm/epoch events"
  api_endpoints:
    - "/events/query"
    - "/events/trigger"
    - "/events/rollback"
    - "/events/logs"
  visualization:
    - "timeline_view"
    - "regional_heatmap"
    - "actor_involvement_graph"

sample_workflows:
  - name: "Ascension Trial Workflow"
    steps:
      - "Detect AscensionTrigger"
      - "Lock local Heavenal Panel for candidate"
      - "Spawn Trial Sequence via ascension_trial.yaml"
      - "Compute tribulation success chance (ascension_trial system)"
      - "If fail → apply tribulation consequences"
      - "If success → register ascension, notify Heavenal Registry"
    linked_systems:
      - "systems/ascension_trial.yaml"
      - "systems/heaven_timer.yaml"
      - "systems/karma_system.yaml"

  - name: "Market Shock Response"
    steps:
      - "Detect market anomaly via codex_economy_trade hooks"
      - "Trigger Regional Event 'Market Crash' template"
      - "Notify Merchant Alliance and GCEB if illegal activity suspected"
      - "Open quests for stabilization and supply runs"
    linked_systems:
      - "systems/shop_catalog.yaml"
      - "systems/karma_system.yaml"

extensibility:
  plugin_interface:
    - "custom_event_templates (GM authored YAML)"
    - "event_transforms (lua/python supported in engine)"
    - "external_scheduler_hooks (for integration with visualization tools)"
  versioning_policy:
    - "Minor updates: backward compatible (vX.Y+)"
    - "Major updates: codex review required"

testing_and_simulation:
  sandbox_mode:
    description: "Full event simulation without world persistence (for testing)."
    features:
      - "time-acceleration"
      - "actor stress tests"
      - "conflict matrix dry-run"
  automated_tests:
    - "unit: event template validation"
    - "integration: codex linkage checks"
    - "fuzz: trigger and persistence edge cases"

verification:
  maintained_by: "Heavenal Control Node"
  validated_on: "2025-11-11"
  sync_with: "manifest.yaml v3.2-secure"
  integrity_check: verified
  checksum: "EVENT-WORLD-VERIFY-2C1B0"
  sign_key: "HCLN-EVENT-ENGINE-SECURE"
