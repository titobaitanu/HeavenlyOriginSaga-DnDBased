# ============================================================
# SYSTEM MODULE — REWARD, LOOT & CHEST TIER SYSTEM
# File: system_modules/system/reward_loot_tier.yaml
# Secure Public Version (v3.2)
# ============================================================
# Maintainer: Heavenal Control Node
# License: Dual (MIT + Heavenal Law Open-Collab)
# ============================================================

meta:
  module_id: "SYS-REWARD-LOOT"
  title: "Heavenal Reward, Loot & Chest Tier System"
  version: 3.2-secure
  author: "Tito Baitanu"
  maintainer: "Heavenal Control Node"
  status: verified
  linked_codex:
    - "codex_heavenal_shop.yaml"
    - "codex_economy_trade.yaml"
    - "codex_heavenal_shop.yaml"
    - "codex_alchemy_forging.yaml"
    - "codex_conflict_matrix.yaml"
  checksum: "SYS-REWARD-SHA-C3F21"
  last_updated: "2025-11-10"

---

description:
  summary: >
    Modul ini menetapkan aturan pembagian hadiah, tier loot, jenis peti,
    mekanik peluang (drop roll), restriksi realm, restock shop/chest,
    dan integrasi event-driven untuk world-event, quest rewards, raid loot,
    serta auction/black-market hooks.
  design_goals:
    - "Keseimbangan ekonomi lintas-realm."
    - "Mencegah eskalasi hukum (law abuse) melalui pembatasan item."
    - "Memberikan variasi dan nilai strategis pada pill/artefak/herb drop."

---

loot_tiers_definition:
  notation: "G = Grade (1..9 mortal, I..III immortal/divine as applicable)"
  mortal:
    - G1: "Common — materials, low herbs, minor coins"        # common
    - G2: "Common+ — consumables, basic crafting mats"
    - G3: "Uncommon — decent herbs, simple pills"
    - G4: "Uncommon+ — low-tier techniques, blueprints"
    - G5: "Rare — quality pills (mortal-tier), minor artifacts"
    - G6: "Rare+ — high-value herbs, specialty catalysts"
    - G7: "Epic — near-immortal materials, exceptional pills (restricted)"
    - G8: "Legendary — border-tier items; primarily auction/leasing"
    - G9: "Mythic — faction/quest-locked treasures; GM vault items"
  immortal:
    - I1..I9: "Immortal-grade items (mirrors of mortal G1..G9 but higher potency)"
    - I10..I20: "High immortal artifacts; special cauldron/forge recipes"
  divine:
    - D1..D100: "Divine artifacts, law cores, Heavenal seals"
  abyssal_cursed:
    - CX: "Cursed variants — high power with karmic debt"
  special:
    - EventUnique: "One-off event artifacts (non-reproducible unless GM allows)"

---

drop_mechanics:
  base_roll:
    expression: "Roll d10000 (1..10000)"
    interpretation:
      - "1..6000 -> Common/stackable"
      - "6001..8500 -> Uncommon"
      - "8501..9500 -> Rare"
      - "9501..9900 -> Epic"
      - "9901..9980 -> Legendary"
      - "9981..10000 -> Mythic/EventUnique"
  modifiers:
    player_level_modifier:
      formula: "floor((PlayerRealmLevelSum) * 0.5)"
      description: "Shifts distribution toward higher-tier drops when positive"
    luck_stat:
      field: "Luck (from gear/traits)"
      effect: "+ (Luck × 0.1)% chance to upgrade one rarity step"
    karma_modifier:
      condition: "Negative Karma increases chance for cursed loot (Abyssal variants)."
    law_resonance_penalty:
      description: "If player lacks required Law Cap, drop may degrade to lower grade."
  group_loot:
    raid_pool: "Shared pool with guaranteed minimum: each member receives 'participation shard' convertible to shop credit."
    boss_unique: "Single-copy items assigned by loot-roll priority (contribution × roll)."

---

chest_types & mechanics:
  common_chest:
    cost: 0 (world spawn)
    restock_interval: "Auto-spawn by world engine per region (every 12 Heavenal hours)"
    guaranteed_min: "G1 × 3"
  merchant_crate:
    cost: "Gold tier price / shop stock"
    restock_interval: "Shop-based (7 Heavenal days for mortal shops; Immortal shops special schedule)"
    guaranteed_min: "G2 × 2"
  celestial_vault:
    access: "Faction / Auction / GM event"
    restock_interval: "Manual GM or event-trigger"
    guaranteed_min: "G6 × 1 or I1 × 1"
  abyssal_cache:
    appearance: "Triggered by abyss incursion events"
    special: "Contains CX items with karmic debt"
  divine_treasure:
    access: "Divine permit or top-tier tribute"
    risk: "May trigger Heavenal Tribunal if misused"

---

shop_loot_integration:
  mortal_shop:
    stock_policy:
      - "Items limited to Mortal grades (G1..G7). G8 only appear via auction/raids; G9 locked."
      - "Restock cycle: 7 Heavenal days for mortal shops."
    quantity_visibility: true
    price_fluctuation:
      formula: "BasePrice × (1 + DemandIndex × 0.02) × RarityMultiplier"
  immortal_shop:
    stock_policy:
      - "Can list Mortal..Immortal items. No cap on purchasable grade but access controlled by reputation & law_limit."
      - "Restock cycle: 30 Heavenal days / special auctions."
  auction_house:
    features:
      - "Timed auctions"
      - "Sealed-bid options"
      - "GM-authenticated legendary transfers"
      - "Cross-realm escrow (requires Heavenal Permit)"

---

crafting_reward_links:
  forging:
    - "Forging success has a chance to produce bonus loot shard(s) or upgrade materials on critical success."
  alchemy:
    - "Alchemy criticals may yield 'Essence Residue' convertible to rare catalysts."
  quest_rewards:
    - "Quest templates specify guaranteed reward tier + possible bonus roll."

---

drop_restrictions & balancing:
  player_restrictions:
    - "Mortal characters cannot receive Divine-grade drops directly."
    - "Items above player's realm may be received as sealed/locked versions requiring unlocking by an appropriate-level crafter or GM."
  duplication_protection:
    - "Unique items flagged; duplication checks run on acquisition. Violation triggers auto-purge & karma penalty."
  economy_sinks:
    - "High grade items require upkeep (binding, activation costs) to remove liquidity and avoid inflation."
  anti-farm_rules:
    - "Repeat farming of the same boss reduces high-tier drop chance by 2% per repeated kill within window (resets after 7 Heavenal days)."

---

reward_scaling_examples:
  - example_1:
      scenario: "Player A (Half-Immortal Lv.3) defeats stage boss (regional)"
      base_drop: "Roll d10000 -> result=9450 (Rare→Epic threshold)"
      modifiers: "Luck +3 → upgrade chance 0.3% (no upgrade)"
      final: "Rare ×1, G5 pill ×2, crafting mats"
  - example_2:
      scenario: "Guild raid (20 players) clear World Boss"
      guaranteed: "Each receives participation shard"
      boss_unique_roll:
        method: "ContributionRank × d1000; top 3 get distribution priority"
      final: "2 players get Epic (G7), 1 player gets Legendary (G8 sealed)"

---

event_engine_triggers:
  world_event_integration:
    - "War / invasion increases regional drop of war spoils and raid caches."
    - "Ascension Trials spawn divine fragments in specific chests."
    - "Abyss incursion spawns abyssal caches (CX) with karmic signatures."
  special_events:
    - "Heavenal Festival: temporary increased spawn rate of rare herbs & pill blueprints."
    - "Divine Audit: random shops flagged; illegal high-tier stock confiscated."

---

gm_tools & commands:
  gm_commands:
    - "/loot inspect <chest_id>"
    - "/loot force_drop <player> <item_id>"
    - "/loot restock <shop_id> <tier>"
    - "/loot lock <item_id> (bind/unbind/seal)"
    - "/auction create <item> <starting_bid>"
    - "/loot audit <region>"
  logging:
    - "All GM loot actions stored in Heavenal Log Archive with changelist and GM signature."

---

integration & api:
  endpoints:
    - "inventory_module.lookup_item(item_id) -> returns item data and lock status"
    - "shop_module.request_purchase(player_id, item_id, qty) -> runs capacity & law checks"
    - "event_engine.spawn_chest(region_id, chest_type, seed) -> returns chest_id"
  callbacks:
    - "onLootAcquire(player_id, item_id) -> triggers karma changes, notify event engine for chained events"

---

security & law:
  restrictions:
    - "Loot that alters world law (eg. Law Cores) requires Great Court permit; otherwise acquisition flagged."
    - "Cross-realm transfer of Divine items triggers auto-review by Heavenal Control Node."
  encryption_and_audit:
    - "All high-tier loot transfers signed and checksummed; auto-audit every 6 Heavenal hours."
    - "GM token required for forced legendary transfers; GM actions recorded."

---

visual_ui & player_feedback:
  ui_components:
    - "Loot popup with graded animation (common→mythic)"
    - "Chest-opening micro-animation (rare = goldenflare)"
    - "Roll result overlay for raid distribution"
  accessibility:
    - "Text-only / high-contrast mode available"
    - "Detailed item tooltips include binding, origin, drop-source, and karma impact"

---

testing & tuning:
  playtest_notes:
    - "Tune base_roll thresholds after 200 world-boss simulations."
    - "Observe economy after 30 in-game days; adjust sink mechanics accordingly."
    - "Ensure mortal G7–G9 items rare enough to remain campaign-level prizes."
  telemetry:
    - "Track drop rates, shop inflation, auction prices, and stock turnover."

---

verification:
  maintained_by: "Heavenal Control Node"
  validated_on: "2025-11-10"
  sync_with: "manifest.yaml v3.2-secure"
  integrity_check: verified
  checksum: "SYS-REWARD-SHA-C3F21"
  sign_key: "HCLN-REWARD-SECURE"
